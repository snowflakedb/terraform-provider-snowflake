// Code generated by SDK builder generator (v0.1.0); DO NOT EDIT.

package sdk

import (
	"context"

	"github.com/Snowflake-Labs/terraform-provider-snowflake/pkg/internal/collections"
)

var _ HybridTables = (*hybridTables)(nil)

var _ convertibleRow[HybridTable] = new(hybridTableRow)
var _ convertibleRow[HybridTableDetails] = new(hybridTableDetailsRow)

type hybridTables struct {
	client *Client
}

func (v *hybridTables) Create(ctx context.Context, request *CreateHybridTableRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *hybridTables) Alter(ctx context.Context, request *AlterHybridTableRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *hybridTables) Drop(ctx context.Context, request *DropHybridTableRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *hybridTables) DropSafely(ctx context.Context, id SchemaObjectIdentifier) error {
	return SafeDrop(v.client, func() error { return v.Drop(ctx, NewDropHybridTableRequest(id).WithIfExists(true)) }, ctx, id)
}

func (v *hybridTables) Show(ctx context.Context, request *ShowHybridTableRequest) ([]HybridTable, error) {
	opts := request.toOpts()
	dbRows, err := validateAndQuery[hybridTableRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[hybridTableRow, HybridTable](dbRows)
}

func (v *hybridTables) ShowByID(ctx context.Context, id SchemaObjectIdentifier) (*HybridTable, error) {
	request := NewShowHybridTableRequest().
		WithLike(Like{Pattern: String(id.Name())}).
		WithIn(In{Schema: id.SchemaId()})
	hybridTables, err := v.Show(ctx, request)
	if err != nil {
		return nil, err
	}
	return collections.FindFirst(hybridTables, func(r HybridTable) bool { return r.Name == id.Name() })
}

func (v *hybridTables) ShowByIDSafely(ctx context.Context, id SchemaObjectIdentifier) (*HybridTable, error) {
	return SafeShowById(v.client, v.ShowByID, ctx, id)
}

func (v *hybridTables) Describe(ctx context.Context, id SchemaObjectIdentifier) ([]HybridTableDetails, error) {
	opts := &DescribeHybridTableOptions{
		name: id,
	}
	rows, err := validateAndQuery[hybridTableDetailsRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[hybridTableDetailsRow, HybridTableDetails](rows)
}

func (r *CreateHybridTableRequest) toOpts() *CreateHybridTableOptions {
	opts := &CreateHybridTableOptions{
		OrReplace:               r.OrReplace,
		IfNotExists:             r.IfNotExists,
		name:                    r.name,
		ColumnsAndConstraints:   r.ColumnsAndConstraints,
		DataRetentionTimeInDays: r.DataRetentionTimeInDays,
		Comment:                 r.Comment,
	}
	return opts
}

func (r *AlterHybridTableRequest) toOpts() *AlterHybridTableOptions {
	opts := &AlterHybridTableOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	if r.ConstraintAction != nil {
		opts.ConstraintAction = &HybridTableConstraintAction{}
		if r.ConstraintAction.Add != nil {
			opts.ConstraintAction.Add = &HybridTableConstraintActionAdd{
				OutOfLineConstraint: r.ConstraintAction.Add.OutOfLineConstraint,
			}
		}
		if r.ConstraintAction.Drop != nil {
			opts.ConstraintAction.Drop = &HybridTableConstraintActionDrop{
				Constraintname:       r.ConstraintAction.Drop.Constraintname,
				ColumnConstraintType: r.ConstraintAction.Drop.ColumnConstraintType,
				Columns:              r.ConstraintAction.Drop.Columns,
			}
		}
		if r.ConstraintAction.Rename != nil {
			opts.ConstraintAction.Rename = &HybridTableConstraintActionRename{
				OldName: r.ConstraintAction.Rename.OldName,
				NewName: r.ConstraintAction.Rename.NewName,
			}
		}
	}
	if r.AlterColumnAction != nil {
		opts.AlterColumnAction = &HybridTableAlterColumnAction{
			ColumnName:   r.AlterColumnAction.ColumnName,
			Comment:      r.AlterColumnAction.Comment,
			UnsetComment: r.AlterColumnAction.UnsetComment,
		}
	}
	if r.DropColumnAction != nil {
		opts.DropColumnAction = &HybridTableDropColumnAction{
			ColumnName: r.DropColumnAction.ColumnName,
		}
	}
	if r.DropIndexAction != nil {
		opts.DropIndexAction = &HybridTableDropIndexAction{
			IndexName: r.DropIndexAction.IndexName,
		}
	}
	if r.BuildIndexAction != nil {
		opts.BuildIndexAction = &HybridTableBuildIndexAction{
			IndexName: r.BuildIndexAction.IndexName,
			Fence:     r.BuildIndexAction.Fence,
			Backfill:  r.BuildIndexAction.Backfill,
		}
	}
	if r.Set != nil {
		opts.Set = &HybridTableSetProperties{
			DataRetentionTimeInDays: r.Set.DataRetentionTimeInDays,
			Comment:                 r.Set.Comment,
		}
	}
	if r.Unset != nil {
		opts.Unset = &HybridTableUnsetProperties{
			DataRetentionTimeInDays: r.Unset.DataRetentionTimeInDays,
			Comment:                 r.Unset.Comment,
		}
	}
	return opts
}

func (r *DropHybridTableRequest) toOpts() *DropHybridTableOptions {
	opts := &DropHybridTableOptions{
		IfExists: r.IfExists,
		name:     r.name,
		Restrict: r.Restrict,
	}
	return opts
}

func (r *ShowHybridTableRequest) toOpts() *ShowHybridTableOptions {
	opts := &ShowHybridTableOptions{
		Terse:      r.Terse,
		Like:       r.Like,
		In:         r.In,
		StartsWith: r.StartsWith,
		Limit:      r.Limit,
	}
	return opts
}

func (r hybridTableRow) convert() (*HybridTable, error) {
	// TODO: Mapping
	return &HybridTable{}, nil
}

func (r *DescribeHybridTableRequest) toOpts() *DescribeHybridTableOptions {
	opts := &DescribeHybridTableOptions{
		name: r.name,
	}
	return opts
}

func (r hybridTableDetailsRow) convert() (*HybridTableDetails, error) {
	// TODO: Mapping
	return &HybridTableDetails{}, nil
}
