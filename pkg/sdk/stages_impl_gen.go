// Code generated by SDK builder generator (v0.1.0); DO NOT EDIT.

package sdk

import (
	"context"

	"github.com/Snowflake-Labs/terraform-provider-snowflake/pkg/internal/collections"
)

var _ Stages = (*stages)(nil)

var _ convertibleRow[StageProperty] = new(stageDescRow)
var _ convertibleRow[Stage] = new(stageShowRow)

type stages struct {
	client *Client
}

func (v *stages) CreateInternal(ctx context.Context, request *CreateInternalStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) CreateOnS3(ctx context.Context, request *CreateOnS3StageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) CreateOnGCS(ctx context.Context, request *CreateOnGCSStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) CreateOnAzure(ctx context.Context, request *CreateOnAzureStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) CreateOnS3Compatible(ctx context.Context, request *CreateOnS3CompatibleStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) Alter(ctx context.Context, request *AlterStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) AlterInternalStage(ctx context.Context, request *AlterInternalStageStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) AlterExternalS3Stage(ctx context.Context, request *AlterExternalS3StageStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) AlterExternalGCSStage(ctx context.Context, request *AlterExternalGCSStageStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) AlterExternalAzureStage(ctx context.Context, request *AlterExternalAzureStageStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) AlterDirectoryTable(ctx context.Context, request *AlterDirectoryTableStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) Drop(ctx context.Context, request *DropStageRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *stages) DropSafely(ctx context.Context, id SchemaObjectIdentifier) error {
	return SafeDrop(v.client, func() error { return v.Drop(ctx, NewDropStageRequest(id).WithIfExists(true)) }, ctx, id)
}

func (v *stages) Describe(ctx context.Context, id SchemaObjectIdentifier) ([]StageProperty, error) {
	opts := &DescribeStageOptions{
		name: id,
	}
	rows, err := validateAndQuery[stageDescRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[stageDescRow, StageProperty](rows)
}

func (v *stages) Show(ctx context.Context, request *ShowStageRequest) ([]Stage, error) {
	opts := request.toOpts()
	dbRows, err := validateAndQuery[stageShowRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[stageShowRow, Stage](dbRows)
}

func (v *stages) ShowByID(ctx context.Context, id SchemaObjectIdentifier) (*Stage, error) {
	request := NewShowStageRequest().
		WithIn(ExtendedIn{In: In{Schema: id.SchemaId()}}).
		WithLike(Like{Pattern: String(id.Name())})
	stages, err := v.Show(ctx, request)
	if err != nil {
		return nil, err
	}
	return collections.FindFirst(stages, func(r Stage) bool { return r.Name == id.Name() })
}

func (v *stages) ShowByIDSafely(ctx context.Context, id SchemaObjectIdentifier) (*Stage, error) {
	return SafeShowById(v.client, v.ShowByID, ctx, id)
}

func (r *CreateInternalStageRequest) toOpts() *CreateInternalStageOptions {
	opts := &CreateInternalStageOptions{
		OrReplace:   r.OrReplace,
		Temporary:   r.Temporary,
		IfNotExists: r.IfNotExists,
		name:        r.name,
		Comment:     r.Comment,
		Tag:         r.Tag,
	}
	if r.Encryption != nil {
		opts.Encryption = &InternalStageEncryption{}
		if r.Encryption.SnowflakeFull != nil {
			opts.Encryption.SnowflakeFull = &InternalStageEncryptionSnowflakeFull{}
		}
		if r.Encryption.SnowflakeSse != nil {
			opts.Encryption.SnowflakeSse = &InternalStageEncryptionSnowflakeSse{}
		}
	}
	if r.DirectoryTableOptions != nil {
		opts.DirectoryTableOptions = &InternalDirectoryTableOptions{
			Enable:      r.DirectoryTableOptions.Enable,
			AutoRefresh: r.DirectoryTableOptions.AutoRefresh,
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *CreateOnS3StageRequest) toOpts() *CreateOnS3StageOptions {
	opts := &CreateOnS3StageOptions{
		OrReplace:   r.OrReplace,
		Temporary:   r.Temporary,
		IfNotExists: r.IfNotExists,
		name:        r.name,
		Comment:     r.Comment,
		Tag:         r.Tag,
	}
	opts.ExternalStageParams = ExternalS3StageParams{
		Url:                    r.ExternalStageParams.Url,
		AwsAccessPointArn:      r.ExternalStageParams.AwsAccessPointArn,
		StorageIntegration:     r.ExternalStageParams.StorageIntegration,
		UsePrivatelinkEndpoint: r.ExternalStageParams.UsePrivatelinkEndpoint,
	}
	if r.ExternalStageParams.Credentials != nil {
		opts.ExternalStageParams.Credentials = &ExternalStageS3Credentials{
			AwsKeyId:     r.ExternalStageParams.Credentials.AwsKeyId,
			AwsSecretKey: r.ExternalStageParams.Credentials.AwsSecretKey,
			AwsToken:     r.ExternalStageParams.Credentials.AwsToken,
			AwsRole:      r.ExternalStageParams.Credentials.AwsRole,
		}
	}
	if r.ExternalStageParams.Encryption != nil {
		opts.ExternalStageParams.Encryption = &ExternalStageS3Encryption{}
		if r.ExternalStageParams.Encryption.AwsCse != nil {
			opts.ExternalStageParams.Encryption.AwsCse = &ExternalStageS3EncryptionAwsCse{
				MasterKey: r.ExternalStageParams.Encryption.AwsCse.MasterKey,
			}
		}
		if r.ExternalStageParams.Encryption.AwsSseS3 != nil {
			opts.ExternalStageParams.Encryption.AwsSseS3 = &ExternalStageS3EncryptionAwsSseS3{}
		}
		if r.ExternalStageParams.Encryption.AwsSseKms != nil {
			opts.ExternalStageParams.Encryption.AwsSseKms = &ExternalStageS3EncryptionAwsSseKms{
				KmsKeyId: r.ExternalStageParams.Encryption.AwsSseKms.KmsKeyId,
			}
		}
		if r.ExternalStageParams.Encryption.None != nil {
			opts.ExternalStageParams.Encryption.None = &ExternalStageS3EncryptionNone{}
		}
	}
	if r.DirectoryTableOptions != nil {
		opts.DirectoryTableOptions = &StageS3CommonDirectoryTableOptions{
			Enable:          r.DirectoryTableOptions.Enable,
			RefreshOnCreate: r.DirectoryTableOptions.RefreshOnCreate,
			AutoRefresh:     r.DirectoryTableOptions.AutoRefresh,
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *CreateOnGCSStageRequest) toOpts() *CreateOnGCSStageOptions {
	opts := &CreateOnGCSStageOptions{
		OrReplace:   r.OrReplace,
		Temporary:   r.Temporary,
		IfNotExists: r.IfNotExists,
		name:        r.name,
		Comment:     r.Comment,
		Tag:         r.Tag,
	}
	opts.ExternalStageParams = ExternalGCSStageParams{
		Url:                r.ExternalStageParams.Url,
		StorageIntegration: r.ExternalStageParams.StorageIntegration,
	}
	if r.ExternalStageParams.Encryption != nil {
		opts.ExternalStageParams.Encryption = &ExternalStageGCSEncryption{}
		if r.ExternalStageParams.Encryption.GcsSseKms != nil {
			opts.ExternalStageParams.Encryption.GcsSseKms = &ExternalStageGCSEncryptionGcsSseKms{
				KmsKeyId: r.ExternalStageParams.Encryption.GcsSseKms.KmsKeyId,
			}
		}
		if r.ExternalStageParams.Encryption.None != nil {
			opts.ExternalStageParams.Encryption.None = &ExternalStageGCSEncryptionNone{}
		}
	}
	if r.DirectoryTableOptions != nil {
		opts.DirectoryTableOptions = &ExternalGCSDirectoryTableOptions{
			Enable:                  r.DirectoryTableOptions.Enable,
			RefreshOnCreate:         r.DirectoryTableOptions.RefreshOnCreate,
			AutoRefresh:             r.DirectoryTableOptions.AutoRefresh,
			NotificationIntegration: r.DirectoryTableOptions.NotificationIntegration,
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *CreateOnAzureStageRequest) toOpts() *CreateOnAzureStageOptions {
	opts := &CreateOnAzureStageOptions{
		OrReplace:   r.OrReplace,
		Temporary:   r.Temporary,
		IfNotExists: r.IfNotExists,
		name:        r.name,
		Comment:     r.Comment,
		Tag:         r.Tag,
	}
	opts.ExternalStageParams = ExternalAzureStageParams{
		Url:                    r.ExternalStageParams.Url,
		StorageIntegration:     r.ExternalStageParams.StorageIntegration,
		UsePrivatelinkEndpoint: r.ExternalStageParams.UsePrivatelinkEndpoint,
	}
	if r.ExternalStageParams.Credentials != nil {
		opts.ExternalStageParams.Credentials = &ExternalStageAzureCredentials{
			AzureSasToken: r.ExternalStageParams.Credentials.AzureSasToken,
		}
	}
	if r.ExternalStageParams.Encryption != nil {
		opts.ExternalStageParams.Encryption = &ExternalStageAzureEncryption{}
		if r.ExternalStageParams.Encryption.AzureCse != nil {
			opts.ExternalStageParams.Encryption.AzureCse = &ExternalStageAzureEncryptionAzureCse{
				MasterKey: r.ExternalStageParams.Encryption.AzureCse.MasterKey,
			}
		}
		if r.ExternalStageParams.Encryption.None != nil {
			opts.ExternalStageParams.Encryption.None = &ExternalStageAzureEncryptionNone{}
		}
	}
	if r.DirectoryTableOptions != nil {
		opts.DirectoryTableOptions = &ExternalAzureDirectoryTableOptions{
			Enable:                  r.DirectoryTableOptions.Enable,
			RefreshOnCreate:         r.DirectoryTableOptions.RefreshOnCreate,
			AutoRefresh:             r.DirectoryTableOptions.AutoRefresh,
			NotificationIntegration: r.DirectoryTableOptions.NotificationIntegration,
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *CreateOnS3CompatibleStageRequest) toOpts() *CreateOnS3CompatibleStageOptions {
	opts := &CreateOnS3CompatibleStageOptions{
		OrReplace:   r.OrReplace,
		Temporary:   r.Temporary,
		IfNotExists: r.IfNotExists,
		name:        r.name,
		Comment:     r.Comment,
		Tag:         r.Tag,
	}
	opts.ExternalStageParams = ExternalS3CompatibleStageParams{
		Url:      r.ExternalStageParams.Url,
		Endpoint: r.ExternalStageParams.Endpoint,
	}
	if r.ExternalStageParams.Credentials != nil {
		opts.ExternalStageParams.Credentials = &ExternalStageS3CompatibleCredentials{
			AwsKeyId:     r.ExternalStageParams.Credentials.AwsKeyId,
			AwsSecretKey: r.ExternalStageParams.Credentials.AwsSecretKey,
		}
	}
	if r.DirectoryTableOptions != nil {
		opts.DirectoryTableOptions = &StageS3CommonDirectoryTableOptions{
			Enable:          r.DirectoryTableOptions.Enable,
			RefreshOnCreate: r.DirectoryTableOptions.RefreshOnCreate,
			AutoRefresh:     r.DirectoryTableOptions.AutoRefresh,
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *AlterStageRequest) toOpts() *AlterStageOptions {
	opts := &AlterStageOptions{
		IfExists:  r.IfExists,
		name:      r.name,
		RenameTo:  r.RenameTo,
		SetTags:   r.SetTags,
		UnsetTags: r.UnsetTags,
	}
	return opts
}

func (r *AlterInternalStageStageRequest) toOpts() *AlterInternalStageStageOptions {
	opts := &AlterInternalStageStageOptions{
		IfExists: r.IfExists,
		name:     r.name,
		Comment:  r.Comment,
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *AlterExternalS3StageStageRequest) toOpts() *AlterExternalS3StageStageOptions {
	opts := &AlterExternalS3StageStageOptions{
		IfExists: r.IfExists,
		name:     r.name,
		Comment:  r.Comment,
	}
	if r.ExternalStageParams != nil {
		opts.ExternalStageParams = &ExternalS3StageParams{
			Url:                    r.ExternalStageParams.Url,
			AwsAccessPointArn:      r.ExternalStageParams.AwsAccessPointArn,
			StorageIntegration:     r.ExternalStageParams.StorageIntegration,
			UsePrivatelinkEndpoint: r.ExternalStageParams.UsePrivatelinkEndpoint,
		}
		if r.ExternalStageParams.Credentials != nil {
			opts.ExternalStageParams.Credentials = &ExternalStageS3Credentials{
				AwsKeyId:     r.ExternalStageParams.Credentials.AwsKeyId,
				AwsSecretKey: r.ExternalStageParams.Credentials.AwsSecretKey,
				AwsToken:     r.ExternalStageParams.Credentials.AwsToken,
				AwsRole:      r.ExternalStageParams.Credentials.AwsRole,
			}
		}
		if r.ExternalStageParams.Encryption != nil {
			opts.ExternalStageParams.Encryption = &ExternalStageS3Encryption{}
			if r.ExternalStageParams.Encryption.AwsCse != nil {
				opts.ExternalStageParams.Encryption.AwsCse = &ExternalStageS3EncryptionAwsCse{
					MasterKey: r.ExternalStageParams.Encryption.AwsCse.MasterKey,
				}
			}
			if r.ExternalStageParams.Encryption.AwsSseS3 != nil {
				opts.ExternalStageParams.Encryption.AwsSseS3 = &ExternalStageS3EncryptionAwsSseS3{}
			}
			if r.ExternalStageParams.Encryption.AwsSseKms != nil {
				opts.ExternalStageParams.Encryption.AwsSseKms = &ExternalStageS3EncryptionAwsSseKms{
					KmsKeyId: r.ExternalStageParams.Encryption.AwsSseKms.KmsKeyId,
				}
			}
			if r.ExternalStageParams.Encryption.None != nil {
				opts.ExternalStageParams.Encryption.None = &ExternalStageS3EncryptionNone{}
			}
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *AlterExternalGCSStageStageRequest) toOpts() *AlterExternalGCSStageStageOptions {
	opts := &AlterExternalGCSStageStageOptions{
		IfExists: r.IfExists,
		name:     r.name,
		Comment:  r.Comment,
	}
	if r.ExternalStageParams != nil {
		opts.ExternalStageParams = &ExternalGCSStageParams{
			Url:                r.ExternalStageParams.Url,
			StorageIntegration: r.ExternalStageParams.StorageIntegration,
		}
		if r.ExternalStageParams.Encryption != nil {
			opts.ExternalStageParams.Encryption = &ExternalStageGCSEncryption{}
			if r.ExternalStageParams.Encryption.GcsSseKms != nil {
				opts.ExternalStageParams.Encryption.GcsSseKms = &ExternalStageGCSEncryptionGcsSseKms{
					KmsKeyId: r.ExternalStageParams.Encryption.GcsSseKms.KmsKeyId,
				}
			}
			if r.ExternalStageParams.Encryption.None != nil {
				opts.ExternalStageParams.Encryption.None = &ExternalStageGCSEncryptionNone{}
			}
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *AlterExternalAzureStageStageRequest) toOpts() *AlterExternalAzureStageStageOptions {
	opts := &AlterExternalAzureStageStageOptions{
		IfExists: r.IfExists,
		name:     r.name,
		Comment:  r.Comment,
	}
	if r.ExternalStageParams != nil {
		opts.ExternalStageParams = &ExternalAzureStageParams{
			Url:                    r.ExternalStageParams.Url,
			StorageIntegration:     r.ExternalStageParams.StorageIntegration,
			UsePrivatelinkEndpoint: r.ExternalStageParams.UsePrivatelinkEndpoint,
		}
		if r.ExternalStageParams.Credentials != nil {
			opts.ExternalStageParams.Credentials = &ExternalStageAzureCredentials{
				AzureSasToken: r.ExternalStageParams.Credentials.AzureSasToken,
			}
		}
		if r.ExternalStageParams.Encryption != nil {
			opts.ExternalStageParams.Encryption = &ExternalStageAzureEncryption{}
			if r.ExternalStageParams.Encryption.AzureCse != nil {
				opts.ExternalStageParams.Encryption.AzureCse = &ExternalStageAzureEncryptionAzureCse{
					MasterKey: r.ExternalStageParams.Encryption.AzureCse.MasterKey,
				}
			}
			if r.ExternalStageParams.Encryption.None != nil {
				opts.ExternalStageParams.Encryption.None = &ExternalStageAzureEncryptionNone{}
			}
		}
	}
	if r.FileFormat != nil {
		opts.FileFormat = &StageFileFormat{
			FormatName: r.FileFormat.FormatName,
		}
	}
	return opts
}

func (r *AlterDirectoryTableStageRequest) toOpts() *AlterDirectoryTableStageOptions {
	opts := &AlterDirectoryTableStageOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	if r.SetDirectory != nil {
		opts.SetDirectory = &DirectoryTableSet{
			Enable: r.SetDirectory.Enable,
		}
	}
	if r.Refresh != nil {
		opts.Refresh = &DirectoryTableRefresh{
			Subpath: r.Refresh.Subpath,
		}
	}
	return opts
}

func (r *DropStageRequest) toOpts() *DropStageOptions {
	opts := &DropStageOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	return opts
}

func (r *DescribeStageRequest) toOpts() *DescribeStageOptions {
	opts := &DescribeStageOptions{
		name: r.name,
	}
	return opts
}

func (r stageDescRow) convert() (*StageProperty, error) {
	// adjusted manually
	stageProp := &StageProperty{
		Parent:  r.ParentProperty,
		Name:    r.Property,
		Type:    r.PropertyType,
		Value:   r.PropertyValue,
		Default: r.PropertyDefault,
	}
	return stageProp, nil
}

func (r *ShowStageRequest) toOpts() *ShowStageOptions {
	opts := &ShowStageOptions{
		Like: r.Like,
		In:   r.In,
	}
	return opts
}

func (r stageShowRow) convert() (*Stage, error) {
	// adjusted manually
	stage := &Stage{
		CreatedOn:        r.CreatedOn,
		Name:             r.Name,
		DatabaseName:     r.DatabaseName,
		SchemaName:       r.SchemaName,
		Url:              r.Url,
		HasCredentials:   r.HasCredentials == "Y",
		HasEncryptionKey: r.HasEncryptionKey == "Y",
		Owner:            r.Owner,
		Comment:          r.Comment,
		Type:             r.Type,
		DirectoryEnabled: r.DirectoryEnabled == "Y",
	}
	if r.Region.Valid {
		stage.Region = &r.Region.String
	}
	if r.Cloud.Valid {
		stage.Cloud = &r.Cloud.String
	}
	if r.StorageIntegration.Valid {
		stage.StorageIntegration = &r.StorageIntegration.String
	}
	if r.Endpoint.Valid {
		stage.Endpoint = &r.Endpoint.String
	}
	if r.OwnerRoleType.Valid {
		stage.OwnerRoleType = &r.OwnerRoleType.String
	}
	return stage, nil
}
