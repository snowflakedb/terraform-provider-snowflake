// Code generated by SDK builder generator (v0.1.0); DO NOT EDIT.

package sdk

import (
	"context"

	"github.com/Snowflake-Labs/terraform-provider-snowflake/pkg/internal/collections"
)

var _ Sequences = (*sequences)(nil)

var _ convertibleRow[Sequence] = new(sequenceRow)
var _ convertibleRow[SequenceDetail] = new(sequenceDetailRow)

type sequences struct {
	client *Client
}

func (v *sequences) Create(ctx context.Context, request *CreateSequenceRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *sequences) Alter(ctx context.Context, request *AlterSequenceRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *sequences) Show(ctx context.Context, request *ShowSequenceRequest) ([]Sequence, error) {
	opts := request.toOpts()
	dbRows, err := validateAndQuery[sequenceRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[sequenceRow, Sequence](dbRows)
}

func (v *sequences) ShowByID(ctx context.Context, id SchemaObjectIdentifier) (*Sequence, error) {
	request := NewShowSequenceRequest().
		WithLike(Like{Pattern: String(id.Name())}).
		WithIn(In{Schema: id.SchemaId()})
	sequences, err := v.Show(ctx, request)
	if err != nil {
		return nil, err
	}
	return collections.FindFirst(sequences, func(r Sequence) bool { return r.Name == id.Name() })
}

func (v *sequences) ShowByIDSafely(ctx context.Context, id SchemaObjectIdentifier) (*Sequence, error) {
	return SafeShowById(v.client, v.ShowByID, ctx, id)
}

func (v *sequences) Describe(ctx context.Context, id SchemaObjectIdentifier) (*SequenceDetail, error) {
	opts := &DescribeSequenceOptions{
		name: id,
	}
	result, err := validateAndQueryOne[sequenceDetailRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return conversionErrorWrapped(result.convert())
}

func (v *sequences) Drop(ctx context.Context, request *DropSequenceRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *sequences) DropSafely(ctx context.Context, id SchemaObjectIdentifier) error {
	return SafeDrop(v.client, func() error { return v.Drop(ctx, NewDropSequenceRequest(id).WithIfExists(true)) }, ctx, id)
}

func (r *CreateSequenceRequest) toOpts() *CreateSequenceOptions {
	opts := &CreateSequenceOptions{
		OrReplace:      r.OrReplace,
		IfNotExists:    r.IfNotExists,
		name:           r.name,
		Start:          r.Start,
		Increment:      r.Increment,
		ValuesBehavior: r.ValuesBehavior,
		Comment:        r.Comment,
	}
	return opts
}

func (r *AlterSequenceRequest) toOpts() *AlterSequenceOptions {
	opts := &AlterSequenceOptions{
		IfExists:     r.IfExists,
		name:         r.name,
		RenameTo:     r.RenameTo,
		SetIncrement: r.SetIncrement,

		UnsetComment: r.UnsetComment,
	}
	if r.Set != nil {
		opts.Set = &SequenceSet{
			ValuesBehavior: r.Set.ValuesBehavior,
			Comment:        r.Set.Comment,
		}
	}
	return opts
}

func (r *ShowSequenceRequest) toOpts() *ShowSequenceOptions {
	opts := &ShowSequenceOptions{
		Like: r.Like,
		In:   r.In,
	}
	return opts
}

func (r sequenceRow) convert() (*Sequence, error) {
	// edited manually
	return &Sequence{
		CreatedOn:     r.CreatedOn,
		Name:          r.Name,
		SchemaName:    r.SchemaName,
		DatabaseName:  r.DatabaseName,
		NextValue:     r.NextValue,
		Interval:      r.Interval,
		Owner:         r.Owner,
		OwnerRoleType: r.OwnerRoleType,
		Comment:       r.Comment,
		Ordered:       r.Ordered == "Y",
	}, nil
}

func (r *DescribeSequenceRequest) toOpts() *DescribeSequenceOptions {
	opts := &DescribeSequenceOptions{
		name: r.name,
	}
	return opts
}

func (r sequenceDetailRow) convert() (*SequenceDetail, error) {
	// edited manually
	return &SequenceDetail{
		CreatedOn:     r.CreatedOn,
		Name:          r.Name,
		SchemaName:    r.SchemaName,
		DatabaseName:  r.DatabaseName,
		NextValue:     r.NextValue,
		Interval:      r.Interval,
		Owner:         r.Owner,
		OwnerRoleType: r.OwnerRoleType,
		Comment:       r.Comment,
		Ordered:       r.Ordered == "Y",
	}, nil
}

func (r *DropSequenceRequest) toOpts() *DropSequenceOptions {
	opts := &DropSequenceOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	if r.Constraint != nil {
		opts.Constraint = &SequenceConstraint{
			Cascade:  r.Constraint.Cascade,
			Restrict: r.Constraint.Restrict,
		}
	}
	return opts
}
