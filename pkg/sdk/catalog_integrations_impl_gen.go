// Code generated by SDK builder generator (v0.1.0); DO NOT EDIT.

package sdk

import (
	"context"

	"github.com/Snowflake-Labs/terraform-provider-snowflake/pkg/internal/collections"
)

var _ CatalogIntegrations = (*catalogIntegrations)(nil)

var _ convertibleRow[CatalogIntegration] = new(showCatalogIntegrationsDbRow)
var _ convertibleRow[CatalogIntegrationProperty] = new(descCatalogIntegrationsDbRow)

type catalogIntegrations struct {
	client *Client
}

func (v *catalogIntegrations) Create(ctx context.Context, request *CreateCatalogIntegrationRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *catalogIntegrations) Alter(ctx context.Context, request *AlterCatalogIntegrationRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *catalogIntegrations) Drop(ctx context.Context, request *DropCatalogIntegrationRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *catalogIntegrations) DropSafely(ctx context.Context, id AccountObjectIdentifier) error {
	return SafeDrop(v.client, func() error { return v.Drop(ctx, NewDropCatalogIntegrationRequest(id).WithIfExists(true)) }, ctx, id)
}

func (v *catalogIntegrations) Show(ctx context.Context, request *ShowCatalogIntegrationRequest) ([]CatalogIntegration, error) {
	opts := request.toOpts()
	dbRows, err := validateAndQuery[showCatalogIntegrationsDbRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[showCatalogIntegrationsDbRow, CatalogIntegration](dbRows)
}

func (v *catalogIntegrations) ShowByID(ctx context.Context, id AccountObjectIdentifier) (*CatalogIntegration, error) {
	request := NewShowCatalogIntegrationRequest().
		WithLike(Like{Pattern: String(id.Name())})
	catalogIntegrations, err := v.Show(ctx, request)
	if err != nil {
		return nil, err
	}
	return collections.FindFirst(catalogIntegrations, func(r CatalogIntegration) bool { return r.Name == id.Name() })
}

func (v *catalogIntegrations) ShowByIDSafely(ctx context.Context, id AccountObjectIdentifier) (*CatalogIntegration, error) {
	return SafeShowById(v.client, v.ShowByID, ctx, id)
}

func (v *catalogIntegrations) Describe(ctx context.Context, id AccountObjectIdentifier) ([]CatalogIntegrationProperty, error) {
	opts := &DescribeCatalogIntegrationOptions{
		name: id,
	}
	rows, err := validateAndQuery[descCatalogIntegrationsDbRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[descCatalogIntegrationsDbRow, CatalogIntegrationProperty](rows)
}

func (r *CreateCatalogIntegrationRequest) toOpts() *CreateCatalogIntegrationOptions {
	opts := &CreateCatalogIntegrationOptions{
		OrReplace:        r.OrReplace,
		IfNotExists:      r.IfNotExists,
		name:             r.name,
		Enabled:          r.Enabled,
		CatalogNamespace: r.CatalogNamespace,
		Comment:          r.Comment,
	}
	if r.ObjectStoreParams != nil {
		opts.ObjectStoreParams = &ObjectStoreParams{
			TableFormat: r.ObjectStoreParams.TableFormat,
		}
	}
	if r.GlueParams != nil {
		opts.GlueParams = &GlueParams{
			TableFormat:    r.GlueParams.TableFormat,
			GlueAwsRoleArn: r.GlueParams.GlueAwsRoleArn,
			GlueCatalogId:  r.GlueParams.GlueCatalogId,
			GlueRegion:     r.GlueParams.GlueRegion,
		}
	}
	if r.IcebergRestParams != nil {
		opts.IcebergRestParams = &IcebergRestParams{
			TableFormat: r.IcebergRestParams.TableFormat,
		}
		if r.IcebergRestParams.RestConfig != nil {
			opts.IcebergRestParams.RestConfig = restConfigRequestToOpts(r.IcebergRestParams.RestConfig)
		}
		if r.IcebergRestParams.RestAuthentication != nil {
			opts.IcebergRestParams.RestAuthentication = restAuthenticationRequestToOpts(r.IcebergRestParams.RestAuthentication)
		}
	}
	if r.PolarisParams != nil {
		opts.PolarisParams = &PolarisParams{
			TableFormat: r.PolarisParams.TableFormat,
		}
		if r.PolarisParams.RestConfig != nil {
			opts.PolarisParams.RestConfig = restConfigRequestToOpts(r.PolarisParams.RestConfig)
		}
		if r.PolarisParams.RestAuthentication != nil {
			opts.PolarisParams.RestAuthentication = restAuthenticationRequestToOpts(r.PolarisParams.RestAuthentication)
		}
	}
	if r.SapBdcParams != nil {
		opts.SapBdcParams = &SapBdcParams{
			TableFormat: r.SapBdcParams.TableFormat,
		}
		if r.SapBdcParams.RestConfig != nil {
			opts.SapBdcParams.RestConfig = restConfigRequestToOpts(r.SapBdcParams.RestConfig)
		}
	}
	return opts
}

func restConfigRequestToOpts(r *RestConfigRequest) *RestConfig {
	return &RestConfig{
		CatalogUri:           r.CatalogUri,
		CatalogName:          r.CatalogName,
		CatalogApiType:       r.CatalogApiType,
		Prefix:               r.Prefix,
		AccessDelegationMode: r.AccessDelegationMode,
	}
}

func restAuthenticationRequestToOpts(r *RestAuthenticationRequest) *RestAuthentication {
	return &RestAuthentication{
		Type:               r.Type,
		OauthClientId:      r.OauthClientId,
		OauthClientSecret:  r.OauthClientSecret,
		OauthTokenUri:      r.OauthTokenUri,
		OauthAllowedScopes: r.OauthAllowedScopes,
		BearerToken:        r.BearerToken,
		Sigv4IamRole:       r.Sigv4IamRole,
		Sigv4SigningRegion: r.Sigv4SigningRegion,
		Sigv4ExternalId:    r.Sigv4ExternalId,
	}
}

func (r *AlterCatalogIntegrationRequest) toOpts() *AlterCatalogIntegrationOptions {
	opts := &AlterCatalogIntegrationOptions{
		IfExists:  r.IfExists,
		name:      r.name,
		SetTags:   r.SetTags,
		UnsetTags: r.UnsetTags,
	}
	if r.Set != nil {
		opts.Set = &CatalogIntegrationSet{
			Enabled:          r.Set.Enabled,
			GlueAwsRoleArn:   r.Set.GlueAwsRoleArn,
			GlueCatalogId:    r.Set.GlueCatalogId,
			GlueRegion:       r.Set.GlueRegion,
			CatalogNamespace: r.Set.CatalogNamespace,
			Comment:          r.Set.Comment,
		}
		if r.Set.RestConfig != nil {
			opts.Set.RestConfig = restConfigRequestToOpts(r.Set.RestConfig)
		}
		if r.Set.RestAuthentication != nil {
			opts.Set.RestAuthentication = restAuthenticationRequestToOpts(r.Set.RestAuthentication)
		}
	}
	if r.Unset != nil {
		opts.Unset = &CatalogIntegrationUnset{
			Enabled:          r.Unset.Enabled,
			CatalogNamespace: r.Unset.CatalogNamespace,
			Comment:          r.Unset.Comment,
		}
	}
	return opts
}

func (r *DropCatalogIntegrationRequest) toOpts() *DropCatalogIntegrationOptions {
	opts := &DropCatalogIntegrationOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	return opts
}

func (r *ShowCatalogIntegrationRequest) toOpts() *ShowCatalogIntegrationOptions {
	opts := &ShowCatalogIntegrationOptions{
		Like: r.Like,
	}
	return opts
}

func (r showCatalogIntegrationsDbRow) convert() (*CatalogIntegration, error) {
	s := &CatalogIntegration{
		Name:      r.Name,
		Type:      r.Type,
		Category:  r.Category,
		Enabled:   r.Enabled,
		CreatedOn: r.CreatedOn,
	}
	if r.Comment.Valid {
		s.Comment = r.Comment.String
	}
	return s, nil
}

func (r *DescribeCatalogIntegrationRequest) toOpts() *DescribeCatalogIntegrationOptions {
	opts := &DescribeCatalogIntegrationOptions{
		name: r.name,
	}
	return opts
}

func (r descCatalogIntegrationsDbRow) convert() (*CatalogIntegrationProperty, error) {
	return &CatalogIntegrationProperty{
		Name:    r.Property,
		Type:    r.PropertyType,
		Value:   r.PropertyValue,
		Default: r.PropertyDefault,
	}, nil
}
