// Code generated by SDK builder generator (v0.1.0); DO NOT EDIT.

package sdk

import (
	"context"

	"github.com/Snowflake-Labs/terraform-provider-snowflake/pkg/internal/collections"
)

var _ CatalogIntegrations = (*catalogIntegrations)(nil)

var (
	_ convertibleRow[CatalogIntegration]         = new(showCatalogIntegrationsDbRow)
	_ convertibleRow[CatalogIntegrationProperty] = new(descCatalogIntegrationsDbRow)
)

type catalogIntegrations struct {
	client *Client
}

func (v *catalogIntegrations) Create(ctx context.Context, request *CreateCatalogIntegrationRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *catalogIntegrations) Alter(ctx context.Context, request *AlterCatalogIntegrationRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *catalogIntegrations) Drop(ctx context.Context, request *DropCatalogIntegrationRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *catalogIntegrations) DropSafely(ctx context.Context, id AccountObjectIdentifier) error {
	return SafeDrop(v.client, func() error { return v.Drop(ctx, NewDropCatalogIntegrationRequest(id).WithIfExists(true)) }, ctx, id)
}

func (v *catalogIntegrations) Show(ctx context.Context, request *ShowCatalogIntegrationRequest) ([]CatalogIntegration, error) {
	opts := request.toOpts()
	dbRows, err := validateAndQuery[showCatalogIntegrationsDbRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[showCatalogIntegrationsDbRow, CatalogIntegration](dbRows)
}

func (v *catalogIntegrations) ShowByID(ctx context.Context, id AccountObjectIdentifier) (*CatalogIntegration, error) {
	request := NewShowCatalogIntegrationRequest().
		WithLike(Like{Pattern: String(id.Name())})
	catalogIntegrations, err := v.Show(ctx, request)
	if err != nil {
		return nil, err
	}
	return collections.FindFirst(catalogIntegrations, func(r CatalogIntegration) bool { return r.Name == id.Name() })
}

func (v *catalogIntegrations) ShowByIDSafely(ctx context.Context, id AccountObjectIdentifier) (*CatalogIntegration, error) {
	return SafeShowById(v.client, v.ShowByID, ctx, id)
}

func (v *catalogIntegrations) Describe(ctx context.Context, id AccountObjectIdentifier) ([]CatalogIntegrationProperty, error) {
	opts := &DescribeCatalogIntegrationOptions{
		name: id,
	}
	rows, err := validateAndQuery[descCatalogIntegrationsDbRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[descCatalogIntegrationsDbRow, CatalogIntegrationProperty](rows)
}

func (r *CreateCatalogIntegrationRequest) toOpts() *CreateCatalogIntegrationOptions {
	opts := &CreateCatalogIntegrationOptions{
		OrReplace:              r.OrReplace,
		IfNotExists:            r.IfNotExists,
		name:                   r.name,
		Enabled:                r.Enabled,
		RefreshIntervalSeconds: r.RefreshIntervalSeconds,
		Comment:                r.Comment,
	}
	if r.AwsGlueCatalogSourceParams != nil {
		opts.AwsGlueCatalogSourceParams = &AwsGlueParams{
			GlueAwsRoleArn:   r.AwsGlueCatalogSourceParams.GlueAwsRoleArn,
			GlueCatalogId:    r.AwsGlueCatalogSourceParams.GlueCatalogId,
			GlueRegion:       r.AwsGlueCatalogSourceParams.GlueRegion,
			CatalogNamespace: r.AwsGlueCatalogSourceParams.CatalogNamespace,
		}
	}
	if r.ObjectStorageCatalogSourceParams != nil {
		opts.ObjectStorageCatalogSourceParams = &ObjectStorageParams{
			TableFormat: r.ObjectStorageCatalogSourceParams.TableFormat,
		}
	}
	if r.OpenCatalogCatalogSourceParams != nil {
		opts.OpenCatalogCatalogSourceParams = &OpenCatalogParams{
			CatalogNamespace: r.OpenCatalogCatalogSourceParams.CatalogNamespace,
		}
		opts.OpenCatalogCatalogSourceParams.RestConfig = OpenCatalogRestConfig{
			CatalogUri:           r.OpenCatalogCatalogSourceParams.RestConfig.CatalogUri,
			CatalogApiType:       r.OpenCatalogCatalogSourceParams.RestConfig.CatalogApiType,
			CatalogName:          r.OpenCatalogCatalogSourceParams.RestConfig.CatalogName,
			AccessDelegationMode: r.OpenCatalogCatalogSourceParams.RestConfig.AccessDelegationMode,
		}
		opts.OpenCatalogCatalogSourceParams.RestAuthentication = OAuthRestAuthentication{
			OauthTokenUri:      r.OpenCatalogCatalogSourceParams.RestAuthentication.OauthTokenUri,
			OauthClientId:      r.OpenCatalogCatalogSourceParams.RestAuthentication.OauthClientId,
			OauthClientSecret:  r.OpenCatalogCatalogSourceParams.RestAuthentication.OauthClientSecret,
			OauthAllowedScopes: r.OpenCatalogCatalogSourceParams.RestAuthentication.OauthAllowedScopes,
		}
	}
	if r.IcebergRestCatalogSourceParams != nil {
		opts.IcebergRestCatalogSourceParams = &IcebergRestParams{
			CatalogNamespace: r.IcebergRestCatalogSourceParams.CatalogNamespace,
		}
		opts.IcebergRestCatalogSourceParams.RestConfig = IcebergRestRestConfig{
			CatalogUri:           r.IcebergRestCatalogSourceParams.RestConfig.CatalogUri,
			Prefix:               r.IcebergRestCatalogSourceParams.RestConfig.Prefix,
			CatalogName:          r.IcebergRestCatalogSourceParams.RestConfig.CatalogName,
			CatalogApiType:       r.IcebergRestCatalogSourceParams.RestConfig.CatalogApiType,
			AccessDelegationMode: r.IcebergRestCatalogSourceParams.RestConfig.AccessDelegationMode,
		}
		if r.IcebergRestCatalogSourceParams.OAuthRestAuthentication != nil {
			opts.IcebergRestCatalogSourceParams.OAuthRestAuthentication = &OAuthRestAuthentication{
				OauthTokenUri:      r.IcebergRestCatalogSourceParams.OAuthRestAuthentication.OauthTokenUri,
				OauthClientId:      r.IcebergRestCatalogSourceParams.OAuthRestAuthentication.OauthClientId,
				OauthClientSecret:  r.IcebergRestCatalogSourceParams.OAuthRestAuthentication.OauthClientSecret,
				OauthAllowedScopes: r.IcebergRestCatalogSourceParams.OAuthRestAuthentication.OauthAllowedScopes,
			}
		}
		if r.IcebergRestCatalogSourceParams.BearerRestAuthentication != nil {
			opts.IcebergRestCatalogSourceParams.BearerRestAuthentication = &BearerRestAuthentication{
				BearerToken: r.IcebergRestCatalogSourceParams.BearerRestAuthentication.BearerToken,
			}
		}
		if r.IcebergRestCatalogSourceParams.SigV4RestAuthentication != nil {
			opts.IcebergRestCatalogSourceParams.SigV4RestAuthentication = &SigV4RestAuthentication{
				Sigv4IamRole:       r.IcebergRestCatalogSourceParams.SigV4RestAuthentication.Sigv4IamRole,
				Sigv4SigningRegion: r.IcebergRestCatalogSourceParams.SigV4RestAuthentication.Sigv4SigningRegion,
				Sigv4ExternalId:    r.IcebergRestCatalogSourceParams.SigV4RestAuthentication.Sigv4ExternalId,
			}
		}
	}
	if r.SapBdcCatalogSourceParams != nil {
		opts.SapBdcCatalogSourceParams = &SapBdcParams{}
		opts.SapBdcCatalogSourceParams.RestConfig = SapBdcRestConfig{
			SapBdcInvitationLink: r.SapBdcCatalogSourceParams.RestConfig.SapBdcInvitationLink,
			AccessDelegationMode: r.SapBdcCatalogSourceParams.RestConfig.AccessDelegationMode,
		}
	}
	return opts
}

func (r *AlterCatalogIntegrationRequest) toOpts() *AlterCatalogIntegrationOptions {
	opts := &AlterCatalogIntegrationOptions{
		IfExists:  r.IfExists,
		name:      r.name,
		SetTags:   r.SetTags,
		UnsetTags: r.UnsetTags,
	}
	if r.Set != nil {
		opts.Set = &CatalogIntegrationSet{
			Enabled:                r.Set.Enabled,
			RefreshIntervalSeconds: r.Set.RefreshIntervalSeconds,
			Comment:                r.Set.Comment,
		}
		if r.Set.SetOAuthRestAuthentication != nil {
			opts.Set.SetOAuthRestAuthentication = &SetOAuthRestAuthentication{
				OauthClientSecret: r.Set.SetOAuthRestAuthentication.OauthClientSecret,
			}
		}
		if r.Set.SetBearerRestAuthentication != nil {
			opts.Set.SetBearerRestAuthentication = &SetBearerRestAuthentication{
				BearerToken: r.Set.SetBearerRestAuthentication.BearerToken,
			}
		}
	}
	return opts
}

func (r *DropCatalogIntegrationRequest) toOpts() *DropCatalogIntegrationOptions {
	opts := &DropCatalogIntegrationOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	return opts
}

func (r *ShowCatalogIntegrationRequest) toOpts() *ShowCatalogIntegrationOptions {
	opts := &ShowCatalogIntegrationOptions{
		Like: r.Like,
	}
	return opts
}

func (r showCatalogIntegrationsDbRow) convert() (*CatalogIntegration, error) {
	// Added manually
	s := &CatalogIntegration{
		Name:      r.Name,
		Enabled:   r.Enabled,
		Type:      r.Type,
		Category:  r.Category,
		CreatedOn: r.CreatedOn,
	}
	if r.Comment.Valid {
		s.Comment = r.Comment.String
	}
	return s, nil
}

func (r *DescribeCatalogIntegrationRequest) toOpts() *DescribeCatalogIntegrationOptions {
	opts := &DescribeCatalogIntegrationOptions{
		name: r.name,
	}
	return opts
}

func (r descCatalogIntegrationsDbRow) convert() (*CatalogIntegrationProperty, error) {
	// Added manually
	return &CatalogIntegrationProperty{
		Name:    r.Property,
		Type:    r.PropertyType,
		Value:   r.PropertyValue,
		Default: r.PropertyDefault,
	}, nil
}
