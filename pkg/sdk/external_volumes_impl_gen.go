// Code generated by SDK builder generator (v0.1.0); DO NOT EDIT.

package sdk

import (
	"context"

	"github.com/Snowflake-Labs/terraform-provider-snowflake/pkg/internal/collections"
)

var _ ExternalVolumes = (*externalVolumes)(nil)

var (
	_ convertibleRow[ExternalVolumeProperty] = new(externalVolumeDescRow)
	_ convertibleRow[ExternalVolume]         = new(externalVolumeShowRow)
)

type externalVolumes struct {
	client *Client
}

func (v *externalVolumes) Create(ctx context.Context, request *CreateExternalVolumeRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *externalVolumes) Alter(ctx context.Context, request *AlterExternalVolumeRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *externalVolumes) Drop(ctx context.Context, request *DropExternalVolumeRequest) error {
	opts := request.toOpts()
	return validateAndExec(v.client, ctx, opts)
}

func (v *externalVolumes) DropSafely(ctx context.Context, id AccountObjectIdentifier) error {
	return SafeDrop(v.client, func() error { return v.Drop(ctx, NewDropExternalVolumeRequest(id).WithIfExists(true)) }, ctx, id)
}

func (v *externalVolumes) Describe(ctx context.Context, id AccountObjectIdentifier) ([]ExternalVolumeProperty, error) {
	opts := &DescribeExternalVolumeOptions{
		name: id,
	}
	rows, err := validateAndQuery[externalVolumeDescRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[externalVolumeDescRow, ExternalVolumeProperty](rows)
}

func (v *externalVolumes) Show(ctx context.Context, request *ShowExternalVolumeRequest) ([]ExternalVolume, error) {
	opts := request.toOpts()
	dbRows, err := validateAndQuery[externalVolumeShowRow](v.client, ctx, opts)
	if err != nil {
		return nil, err
	}
	return convertRows[externalVolumeShowRow, ExternalVolume](dbRows)
}

func (v *externalVolumes) ShowByID(ctx context.Context, id AccountObjectIdentifier) (*ExternalVolume, error) {
	request := NewShowExternalVolumeRequest().
		WithLike(Like{Pattern: String(id.Name())})
	externalVolumes, err := v.Show(ctx, request)
	if err != nil {
		return nil, err
	}
	return collections.FindFirst(externalVolumes, func(r ExternalVolume) bool { return r.Name == id.Name() })
}

func (v *externalVolumes) ShowByIDSafely(ctx context.Context, id AccountObjectIdentifier) (*ExternalVolume, error) {
	return SafeShowById(v.client, v.ShowByID, ctx, id)
}

func (r *CreateExternalVolumeRequest) toOpts() *CreateExternalVolumeOptions {
	opts := &CreateExternalVolumeOptions{
		OrReplace:        r.OrReplace,
		IfNotExists:      r.IfNotExists,
		name:             r.name,
		StorageLocations: r.StorageLocations,
		AllowWrites:      r.AllowWrites,
		Comment:          r.Comment,
	}
	return opts
}

func (r *AlterExternalVolumeRequest) toOpts() *AlterExternalVolumeOptions {
	opts := &AlterExternalVolumeOptions{
		IfExists:              r.IfExists,
		name:                  r.name,
		RemoveStorageLocation: r.RemoveStorageLocation,
	}
	if r.Set != nil {
		opts.Set = &AlterExternalVolumeSet{
			AllowWrites: r.Set.AllowWrites,
			Comment:     r.Set.Comment,
		}
	}
	if r.AddStorageLocation != nil {
		opts.AddStorageLocation = &ExternalVolumeStorageLocationItem{}
		opts.AddStorageLocation.ExternalVolumeStorageLocation = ExternalVolumeStorageLocation{
			Name: r.AddStorageLocation.ExternalVolumeStorageLocation.Name,
		}
		if r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams != nil {
			opts.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams = &S3StorageLocationParams{
				StorageProvider:          r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.StorageProvider,
				StorageAwsRoleArn:        r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.StorageAwsRoleArn,
				StorageBaseUrl:           r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.StorageBaseUrl,
				StorageAwsExternalId:     r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.StorageAwsExternalId,
				StorageAwsAccessPointArn: r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.StorageAwsAccessPointArn,
				UsePrivatelinkEndpoint:   r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.UsePrivatelinkEndpoint,
			}
			if r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.Encryption != nil {
				opts.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.Encryption = &ExternalVolumeS3Encryption{
					EncryptionType: r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.Encryption.EncryptionType,
					KmsKeyId:       r.AddStorageLocation.ExternalVolumeStorageLocation.S3StorageLocationParams.Encryption.KmsKeyId,
				}
			}
		}
		if r.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams != nil {
			opts.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams = &GCSStorageLocationParams{
				StorageBaseUrl: r.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams.StorageBaseUrl,
			}
			if r.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams.Encryption != nil {
				opts.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams.Encryption = &ExternalVolumeGCSEncryption{
					EncryptionType: r.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams.Encryption.EncryptionType,
					KmsKeyId:       r.AddStorageLocation.ExternalVolumeStorageLocation.GCSStorageLocationParams.Encryption.KmsKeyId,
				}
			}
		}
		if r.AddStorageLocation.ExternalVolumeStorageLocation.AzureStorageLocationParams != nil {
			opts.AddStorageLocation.ExternalVolumeStorageLocation.AzureStorageLocationParams = &AzureStorageLocationParams{
				AzureTenantId:          r.AddStorageLocation.ExternalVolumeStorageLocation.AzureStorageLocationParams.AzureTenantId,
				StorageBaseUrl:         r.AddStorageLocation.ExternalVolumeStorageLocation.AzureStorageLocationParams.StorageBaseUrl,
				UsePrivatelinkEndpoint: r.AddStorageLocation.ExternalVolumeStorageLocation.AzureStorageLocationParams.UsePrivatelinkEndpoint,
			}
		}
		if r.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams != nil {
			opts.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams = &S3CompatStorageLocationParams{
				StorageBaseUrl:  r.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams.StorageBaseUrl,
				StorageEndpoint: r.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams.StorageEndpoint,
			}
			opts.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams.Credentials = ExternalVolumeS3CompatCredentials{
				AwsKeyId:     r.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams.Credentials.AwsKeyId,
				AwsSecretKey: r.AddStorageLocation.ExternalVolumeStorageLocation.S3CompatStorageLocationParams.Credentials.AwsSecretKey,
			}
		}
	}
	if r.UpdateStorageLocation != nil {
		opts.UpdateStorageLocation = &AlterExternalVolumeUpdateStorageLocation{
			StorageLocation: r.UpdateStorageLocation.StorageLocation,
		}
		opts.UpdateStorageLocation.Credentials = ExternalVolumeUpdateCredentials{
			AwsKeyId:     r.UpdateStorageLocation.Credentials.AwsKeyId,
			AwsSecretKey: r.UpdateStorageLocation.Credentials.AwsSecretKey,
		}
	}
	return opts
}

func (r *DropExternalVolumeRequest) toOpts() *DropExternalVolumeOptions {
	opts := &DropExternalVolumeOptions{
		IfExists: r.IfExists,
		name:     r.name,
	}
	return opts
}

func (r *DescribeExternalVolumeRequest) toOpts() *DescribeExternalVolumeOptions {
	opts := &DescribeExternalVolumeOptions{
		name: r.name,
	}
	return opts
}

func (r externalVolumeDescRow) convert() (*ExternalVolumeProperty, error) {
	return &ExternalVolumeProperty{
		Parent:  r.ParentProperty,
		Name:    r.Property,
		Type:    r.PropertyType,
		Value:   r.PropertyValue,
		Default: r.PropertyDefault,
	}, nil
}

func (r *ShowExternalVolumeRequest) toOpts() *ShowExternalVolumeOptions {
	opts := &ShowExternalVolumeOptions{
		Like: r.Like,
	}
	return opts
}

func (r externalVolumeShowRow) convert() (*ExternalVolume, error) {
	externalVolume := ExternalVolume{
		Name:        r.Name,
		AllowWrites: r.AllowWrites,
	}

	if r.Comment.Valid {
		externalVolume.Comment = r.Comment.String
	}

	return &externalVolume, nil
}
