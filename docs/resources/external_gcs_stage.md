---
page_title: "snowflake_external_gcs_stage Resource - terraform-provider-snowflake"
subcategory: "Preview"
description: |-
  Resource used to manage external GCS stages. For more information, check external stage documentation https://docs.snowflake.com/en/sql-reference/sql/create-stage#external-stage-parameters-externalstageparams.
---

!> **Caution: Preview Feature** This feature is considered a preview feature in the provider, regardless of the state of the resource in Snowflake. We do not guarantee its stability. It will be reworked and marked as a stable feature in future releases. Breaking changes are expected, even without bumping the major version. To use this feature, add the relevant feature name to `preview_features_enabled` field in the [provider configuration](https://registry.terraform.io/providers/snowflakedb/snowflake/latest/docs#schema). Please always refer to the [Getting Help](https://github.com/snowflakedb/terraform-provider-snowflake?tab=readme-ov-file#getting-help) section in our Github repo to best determine how to get help for your questions.

-> **Note** Temporary stages are not supported because they result in per-session objects.

-> **Note** External changes detection on the `encryption` and `directory.notification_integration` fields are not supported because Snowflake does not return such settings in DESCRIBE or SHOW STAGE output.

-> **Note** Due to Snowflake limitations, when `directory.auto_refresh` is set to a new value in the configuration, the resource is recreated. When it is unset, the provider alters the whole `directory` field with the `enable` value from the configuration.

# snowflake_external_gcs_stage (Resource)

Resource used to manage external GCS stages. For more information, check [external stage documentation](https://docs.snowflake.com/en/sql-reference/sql/create-stage#external-stage-parameters-externalstageparams).

## Example Usage

-> **Note** Instead of using fully_qualified_name, you can reference objects managed outside Terraform by constructing a correct ID, consult [identifiers guide](../guides/identifiers_rework_design_decisions#new-computed-fully-qualified-name-field-in-resources).
<!-- TODO(SNOW-1634854): include an example showing both methods-->

```terraform
# Basic resource with storage integration (required for GCS)
resource "snowflake_external_gcs_stage" "basic" {
  name                = "my_gcs_stage"
  database            = "my_database"
  schema              = "my_schema"
  url                 = "gcs://mybucket/mypath/"
  storage_integration = snowflake_storage_integration.gcs.name
}

# Complete resource with all options
resource "snowflake_external_gcs_stage" "complete" {
  name                = "complete_gcs_stage"
  database            = "my_database"
  schema              = "my_schema"
  url                 = "gcs://mybucket/mypath/"
  storage_integration = snowflake_storage_integration.gcs.name

  encryption {
    gcs_sse_kms {
      kms_key_id = var.gcs_kms_key_id
    }
  }

  directory {
    enable            = true
    refresh_on_create = true
    auto_refresh      = false
  }

  comment = "Fully configured GCS external stage"
}

# Resource with encryption set to none
resource "snowflake_external_gcs_stage" "no_encryption" {
  name                = "gcs_stage_no_encryption"
  database            = "my_database"
  schema              = "my_schema"
  url                 = "gcs://mybucket/mypath/"
  storage_integration = snowflake_storage_integration.gcs.name

  encryption {
    none {}
  }
}

# Resource with GCS SSE KMS encryption without specifying key
resource "snowflake_external_gcs_stage" "default_kms" {
  name                = "gcs_stage_default_kms"
  database            = "my_database"
  schema              = "my_schema"
  url                 = "gcs://mybucket/mypath/"
  storage_integration = snowflake_storage_integration.gcs.name

  encryption {
    gcs_sse_kms {}
  }
}
```

-> **Note** If a field has a default value, it is shown next to the type in the schema.

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `database` (String) The database in which to create the stage. Due to technical limitations (read more [here](../guides/identifiers_rework_design_decisions#known-limitations-and-identifier-recommendations)), avoid using the following characters: `|`, `.`, `"`.
- `name` (String) Specifies the identifier for the stage; must be unique for the database and schema in which the stage is created. Due to technical limitations (read more [here](../guides/identifiers_rework_design_decisions#known-limitations-and-identifier-recommendations)), avoid using the following characters: `|`, `.`, `"`.
- `schema` (String) The schema in which to create the stage. Due to technical limitations (read more [here](../guides/identifiers_rework_design_decisions#known-limitations-and-identifier-recommendations)), avoid using the following characters: `|`, `.`, `"`.
- `storage_integration` (String) Specifies the name of the storage integration used to delegate authentication responsibility to a Snowflake identity. GCS stages require a storage integration. Due to technical limitations (read more [here](../guides/identifiers_rework_design_decisions#known-limitations-and-identifier-recommendations)), avoid using the following characters: `|`, `.`, `"`.
- `url` (String) Specifies the URL for the GCS bucket (e.g., 'gcs://bucket/path/').

### Optional

- `comment` (String) Specifies a comment for the stage.
- `directory` (Block List, Max: 1) Directory tables store a catalog of staged files in cloud storage. (see [below for nested schema](#nestedblock--directory))
- `encryption` (Block List, Max: 1) Specifies the encryption settings for the GCS external stage. (see [below for nested schema](#nestedblock--encryption))
- `timeouts` (Block, Optional) (see [below for nested schema](#nestedblock--timeouts))

### Read-Only

- `cloud` (String) Specifies a cloud provider for the stage. This field is used for checking external changes and recreating the resources if needed.
- `describe_output` (List of Object) Outputs the result of `DESCRIBE STAGE` for the given stage. (see [below for nested schema](#nestedatt--describe_output))
- `fully_qualified_name` (String) Fully qualified name of the resource. For more information, see [object name resolution](https://docs.snowflake.com/en/sql-reference/name-resolution).
- `id` (String) The ID of this resource.
- `show_output` (List of Object) Outputs the result of `SHOW STAGES` for the given stage. (see [below for nested schema](#nestedatt--show_output))
- `stage_type` (String) Specifies a type for the stage. This field is used for checking external changes and recreating the resources if needed.

<a id="nestedblock--directory"></a>
### Nested Schema for `directory`

Required:

- `enable` (Boolean) Specifies whether to enable a directory table on the external stage.

Optional:

- `auto_refresh` (String) (Default: fallback to Snowflake default - uses special value that cannot be set in the configuration manually (`default`)) Specifies whether Snowflake should enable triggering automatic refreshes of the directory table metadata.
- `notification_integration` (String) Specifies the name of the notification integration used to automatically refresh the directory table metadata. Due to technical limitations (read more [here](../guides/identifiers_rework_design_decisions#known-limitations-and-identifier-recommendations)), avoid using the following characters: `|`, `.`, `"`.
- `refresh_on_create` (String) (Default: fallback to Snowflake default - uses special value that cannot be set in the configuration manually (`default`)) Specifies whether to automatically refresh the directory table metadata once, immediately after the stage is created.This field is used only when creating the object. Changes on this field are ignored after creation.


<a id="nestedblock--encryption"></a>
### Nested Schema for `encryption`

Optional:

- `gcs_sse_kms` (Block List, Max: 1) GCS server-side encryption using a KMS key. (see [below for nested schema](#nestedblock--encryption--gcs_sse_kms))
- `none` (Block List, Max: 1) No encryption. (see [below for nested schema](#nestedblock--encryption--none))

<a id="nestedblock--encryption--gcs_sse_kms"></a>
### Nested Schema for `encryption.gcs_sse_kms`

Optional:

- `kms_key_id` (String) Specifies the KMS-managed key ID.


<a id="nestedblock--encryption--none"></a>
### Nested Schema for `encryption.none`



<a id="nestedblock--timeouts"></a>
### Nested Schema for `timeouts`

Optional:

- `create` (String)
- `delete` (String)
- `read` (String)
- `update` (String)


<a id="nestedatt--describe_output"></a>
### Nested Schema for `describe_output`

Read-Only:

- `directory_table` (List of Object) (see [below for nested schema](#nestedobjatt--describe_output--directory_table))
- `file_format` (List of Object) (see [below for nested schema](#nestedobjatt--describe_output--file_format))

<a id="nestedobjatt--describe_output--directory_table"></a>
### Nested Schema for `describe_output.directory_table`

Read-Only:

- `auto_refresh` (Boolean)
- `enable` (Boolean)


<a id="nestedobjatt--describe_output--file_format"></a>
### Nested Schema for `describe_output.file_format`

Read-Only:

- `avro` (List of Object) (see [below for nested schema](#nestedobjatt--describe_output--file_format--avro))
- `csv` (List of Object) (see [below for nested schema](#nestedobjatt--describe_output--file_format--csv))
- `format_name` (String)
- `json` (List of Object) (see [below for nested schema](#nestedobjatt--describe_output--file_format--json))
- `orc` (List of Object) (see [below for nested schema](#nestedobjatt--describe_output--file_format--orc))

<a id="nestedobjatt--describe_output--file_format--avro"></a>
### Nested Schema for `describe_output.file_format.avro`

Read-Only:

- `compression` (String)
- `null_if` (List of String)
- `replace_invalid_characters` (Boolean)
- `trim_space` (Boolean)
- `type` (String)


<a id="nestedobjatt--describe_output--file_format--csv"></a>
### Nested Schema for `describe_output.file_format.csv`

Read-Only:

- `binary_format` (String)
- `compression` (String)
- `date_format` (String)
- `empty_field_as_null` (Boolean)
- `encoding` (String)
- `error_on_column_count_mismatch` (Boolean)
- `escape` (String)
- `escape_unenclosed_field` (String)
- `field_delimiter` (String)
- `field_optionally_enclosed_by` (String)
- `file_extension` (String)
- `multi_line` (Boolean)
- `null_if` (List of String)
- `parse_header` (Boolean)
- `record_delimiter` (String)
- `replace_invalid_characters` (Boolean)
- `skip_blank_lines` (Boolean)
- `skip_byte_order_mark` (Boolean)
- `skip_header` (Number)
- `time_format` (String)
- `timestamp_format` (String)
- `trim_space` (Boolean)
- `type` (String)
- `validate_utf8` (Boolean)


<a id="nestedobjatt--describe_output--file_format--json"></a>
### Nested Schema for `describe_output.file_format.json`

Read-Only:

- `allow_duplicate` (Boolean)
- `binary_format` (String)
- `compression` (String)
- `date_format` (String)
- `enable_octal` (Boolean)
- `file_extension` (String)
- `ignore_utf8_errors` (Boolean)
- `multi_line` (Boolean)
- `null_if` (List of String)
- `replace_invalid_characters` (Boolean)
- `skip_byte_order_mark` (Boolean)
- `strip_null_values` (Boolean)
- `strip_outer_array` (Boolean)
- `time_format` (String)
- `timestamp_format` (String)
- `trim_space` (Boolean)
- `type` (String)


<a id="nestedobjatt--describe_output--file_format--orc"></a>
### Nested Schema for `describe_output.file_format.orc`

Read-Only:

- `null_if` (List of String)
- `replace_invalid_characters` (Boolean)
- `trim_space` (Boolean)
- `type` (String)




<a id="nestedatt--show_output"></a>
### Nested Schema for `show_output`

Read-Only:

- `cloud` (String)
- `comment` (String)
- `created_on` (String)
- `database_name` (String)
- `directory_enabled` (Boolean)
- `endpoint` (String)
- `has_credentials` (Boolean)
- `has_encryption_key` (Boolean)
- `name` (String)
- `owner` (String)
- `owner_role_type` (String)
- `region` (String)
- `schema_name` (String)
- `storage_integration` (String)
- `type` (String)
- `url` (String)

## Import

Import is supported using the following syntax:

```shell
terraform import snowflake_external_gcs_stage.example '"<database_name>"."<schema_name>"."<stage_name>"'
```
